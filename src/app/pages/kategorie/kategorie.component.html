<app-go-back-button> </app-go-back-button>
<article>
  <h1>
    {{ this.name }}
  </h1>

  @if (this.description) {
    <p [innerHTML]="this.description" class="text-sm hyphens-auto text-gray-600 lg:text-lg">
      {{ this.description }}
    </p>
  }

  <!-- Search input -->
  <div class="flex flex-row justify-between">
    <div class="inline-flex max-h-10 w-[calc(100%-125px)] items-center justify-between rounded-2xl border border-gray-300">
      <label class="sr-only" for="category-search">{{ 'SEARCH.LABEL' | translate }}</label>
      <input
        id="category-search"
        type="search"
        class="w-full border-none p-2"
        [value]="searchTerm"
        (input)="onSearchChange($any($event.target).value)"
        [attr.aria-label]="'SEARCH.LABEL' | translate"
        [placeholder]="'SEARCH.PLACEHOLDER' | translate"
        [attr.aria-busy]="searching"
      />
      <app-icon name="search" class="mr-3 ml-2 h-6 w-6" aria-hidden="true" />
    </div>
    <button
      class="filter-option mb-0 flex w-[110px] cursor-pointer items-start justify-around rounded-t-2xl"
      [ngClass]="
        filterOpen ? 'h-14 items-start bg-gray-100' : 'h-10 items-center rounded-2xl border-1 border-gray-300 hover:scale-102'
      "
      (click)="toggleFilter()"
      (keypress)="toggleFilter()"
      tabindex="0"
    >
      <div class="flex h-10 items-center">
        <span>{{ 'all-categories.filter' | translate }}</span>
        <app-icon [name]="filterOpen ? 'filter-off' : 'filter'" class="mr-1 h-6 w-6" aria-hidden="true" />
      </div>
    </button>
  </div>

  @if (searching) {
    <div class="mt-2 flex items-center text-sm text-gray-500" aria-live="polite" aria-busy="true">
      <span class="mr-2 inline-block h-4 w-4 animate-spin rounded-full border-2 border-[#c70d56] border-t-transparent"></span>
      {{ 'SEARCH.SEARCHING' | translate }}
    </div>
  }

  <!-- Filter Optionen -->
  @if (filterOpen) {
    <div class="filter-option slide-down mt-0 w-full overflow-hidden rounded-tl-2xl rounded-b-2xl bg-gray-100 pb-4">
      <div class="grid w-full justify-around gap-4 px-4 lg:grid-cols-[2fr_3fr_3fr_5fr]">
        <div class="flex flex-col">
          <div>
            <h3>{{ 'all-categories.date-from' | translate }}</h3>
            <input type="date" name="date-from" id="date-from" class="w-full bg-white" (change)="setSelectedDateStart($any($event.target).valueAsDate)" />
          </div>
          <div>
            <h3>{{ 'all-categories.date-to' | translate }}</h3>
            <input type="date" name="date-to" id="date-to" class="w-full bg-white" (change)="setSelectedDateEnd($any($event.target).valueAsDate)" />
          </div>
        </div>

        <div>
          <h3>{{ 'event-detail.eventlocation' | translate }}</h3>
          <app-custom-dropdown
            [items]="getLocations()"
            [placeholder]="'all-categories.all-locations' | translate"
            (selectionChange)="setSelectedLocations($event)"
          />
        </div>

        <div>
          <h3>{{ 'all-categories.prices' | translate }}</h3>
          <app-custom-dropdown
            [items]="getPrices()"
            [placeholder]="'all-categories.all-prices' | translate"
            (selectionChange)="setSelectedPrices($event)"
          />
        </div>

        <div>
          <h3>{{ 'home.categories' | translate }}</h3>
          <div class="grid grid-cols-2 gap-4">
            @for (categorie of categories; track categorie.id) {
              <app-kategorie-card
                [color]="categorie.color"
                [text]="categorie.name"
                [id]="categorie.id?.id?.toString()"
                [filterOption]="true"
                [selected]="categoryIds.includes(categorie.id!.id) ? true : false"
                (categoryAdded)="setSelectedCategories($event)"
              />
            }
          </div>
        </div>
      </div>
    </div>
  }

  <!-- Ladeanzeige (nur für Initial-Load, nicht während der Suche) -->
  @if (loading && !searchTerm) {
    <app-loading-spinner />
    <div class="mr-2 ml-2 grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-3">
      @for (item of [].constructor(3); track $index) {
        <div class="mx-auto w-full rounded rounded-2xl bg-white shadow-lg">
          <div class="h-48 animate-pulse overflow-hidden bg-gray-200 p-3"></div>
          <div class="h- p-3">
            <div class="mt-2 grid grid-cols-2 gap-4">
              <div class="col-span-2 h-8 animate-pulse rounded bg-gray-200"></div>
              <div class="h-4 animate-pulse rounded bg-gray-200"></div>
              <div class="h-4 animate-pulse rounded bg-gray-200"></div>
              <div class="h-4 animate-pulse rounded bg-gray-200"></div>
              <div class="h-4 animate-pulse rounded bg-gray-200"></div>
            </div>
          </div>
        </div>
      }
    </div>
  }

  <!-- Keine Events Meldung -->
  @if (!loading && events.length === 0) {
    <div class="rounded-2xl bg-gray-100 p-4 text-center">
      <p>
        {{ 'EVENTS.NO_EVENTS_FOUND_IN_CATEGORY' | translate }}
      </p>
    </div>
  }

  <div class="grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-3">
    @for (event of events; track trackByEvent($index, event)) {
      @if ($index === 0 || (event.date_start | date: 'yyyyMM') !== (events[$index - 1].date_start | date: 'yyyyMM')) {
        <nav class="sr-only col-span-full" aria-label="Monatsnavigation">
          @if ($index > 0) {
            <a [attr.href]="'#month-' + (events[$index - 1].date_start | date: 'yyyy-MM')"> Zum vorherigen Monat springen </a>
          }
        </nav>
        <h2
          class="col-span-full mt-6 mb-2 border-b border-blue-900 pb-1 text-2xl font-bold"
          [attr.id]="'month-' + (event.date_start | date: 'yyyy-MM')"
          [attr.aria-describedby]="'month-' + (event.date_start | date: 'yyyy-MM') + '-desc'"
        >
          @if (event.isPast) {
            {{ 'EVENTS.PAST_PREFIX' | translate }} {{ event.date_start | date: 'MMMM yyyy' }}
          } @else {
            {{ event.date_start | date: 'MMMM yyyy' }}
          }
        </h2>
        <p class="sr-only col-span-full" [attr.id]="'month-' + (event.date_start | date: 'yyyy-MM') + '-desc'">
          Abschnitt:
          @if (event.isPast) {
            {{ 'EVENTS.PAST_PREFIX' | translate }}
          }
          {{ event.date_start | date: 'MMMM yyyy' }}. Verwenden Sie die Überschriftennavigation Ihres Screenreaders, um zum
          nächsten Monat zu springen.
        </p>
      }
      <div class="relative">
        <app-event-card [event]="event" [class.opacity-70]="event.isPast"> </app-event-card>
      </div>
    }
  </div>
</article>
