<app-go-back-button> </app-go-back-button>
<article>
  <h1>
    {{ this.name }}
  </h1>

  @if (this.description) {
    <p [innerHTML]="this.description" class="text-sm hyphens-auto text-gray-600 lg:text-lg">
      {{ this.description }}
    </p>
  }

  <!-- Search input -->
  <div class="mb-4 inline-flex w-full items-center justify-between rounded-2xl border border-gray-300">
    <label class="sr-only" for="category-search">{{ 'SEARCH.LABEL' | translate }}</label>
    <input
      id="category-search"
      type="search"
      class="w-full border-none p-2"
      [value]="searchTerm"
      (input)="onSearchChange($any($event.target).value)"
      [attr.aria-label]="'SEARCH.LABEL' | translate"
      [placeholder]="'SEARCH.PLACEHOLDER' | translate"
      [attr.aria-busy]="searching"
    />
    @if (searching) {
      <div class="mt-2 flex items-center text-sm text-gray-500" aria-live="polite" aria-busy="true">
        <span class="mr-2 inline-block h-4 w-4 animate-spin rounded-full border-2 border-[#c70d56] border-t-transparent"></span>
        {{ 'SEARCH.SEARCHING' | translate }}
      </div>
    }
    <app-icon name="search" class="mr-3 h-6 w-6" aria-hidden="true" />
  </div>

  <div class="mb-4" [ngClass]="filterOpen ? 'filter-option flex-col' : ''">
    <button
      class="filter-option cursor-pointer"
      [ngClass]="filterOpen ? '' : 'hover:scale-102'"
      (click)="toggleFilter()"
      (keypress)="toggleFilter()"
      tabindex="0"
    >
      <span>{{ 'all-categories.filter' | translate }}</span>
      <app-icon [name]="filterOpen ? 'filter-off' : 'filter'" class="mr-1 h-6 w-6" aria-hidden="true" />
    </button>
    @if (filterOpen) {
      <div class="flex w-full justify-between gap-4 px-4">
        <div>
          <h3>{{ 'event-detail.eventlocation' | translate }}</h3>
          <app-custom-dropdown
            [items]="getLocations()"
            [placeholder]="'all-categories.all-locations' | translate"
            (selectionChange)="setSelectedLocations($event)"
          />
        </div>

        <div>
          <h3>{{ 'home.categories' | translate }}</h3>
          <div class="mr-2 ml-2 grid grid-cols-2 gap-4">
            @for (categorie of categories; track categorie.id) {
              <app-kategorie-card
                [color]="categorie.color"
                [text]="categorie.name"
                [id]="categorie.id?.id?.toString()"
                [filterOption]="true"
                (categoryAdded)="setSelectedCategories($event)"
                />
            }
          </div>
        </div>
      </div>
    }
  </div>

  <!-- Ladeanzeige (nur für Initial-Load, nicht während der Suche) -->
  @if (loading && !searchTerm) {
    <app-loading-spinner />
    <div class="mr-2 ml-2 grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-3">
      @for (item of [].constructor(3); track $index) {
        <div class="mx-auto w-full rounded rounded-2xl bg-white shadow-lg">
          <div class="h-48 animate-pulse overflow-hidden bg-gray-200 p-3"></div>
          <div class="h- p-3">
            <div class="mt-2 grid grid-cols-2 gap-4">
              <div class="col-span-2 h-8 animate-pulse rounded bg-gray-200"></div>
              <div class="h-4 animate-pulse rounded bg-gray-200"></div>
              <div class="h-4 animate-pulse rounded bg-gray-200"></div>
              <div class="h-4 animate-pulse rounded bg-gray-200"></div>
              <div class="h-4 animate-pulse rounded bg-gray-200"></div>
            </div>
          </div>
        </div>
      }
    </div>
  }

  <!-- Keine Events Meldung -->
  @if (!loading && events.length === 0) {
    <div class="rounded-lg bg-gray-100 p-4 text-center">
      <p>
        {{ 'EVENTS.NO_EVENTS_FOUND_IN_CATEGORY' | translate }}
      </p>
    </div>
  }

  <div class="grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-3">
    @for (event of events; track trackByEvent($index, event)) {
      <div class="relative">
        <app-event-card [event]="event" [class.opacity-70]="event.isPast"> </app-event-card>
      </div>
    }
  </div>
</article>
